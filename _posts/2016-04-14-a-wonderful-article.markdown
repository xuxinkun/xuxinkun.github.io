---
layout:     post
title:      "一篇精彩的洗地文"
subtitle:   "A wonderful article"
date:       2016-04-14 8:00:00
author:     "XuXinkun"
header-img: "img/post-bg-wonderful-article.jpg"
tags:

---

# 写在前面

前段时间读了一篇知乎帖子，相当精彩。后来研究了帖子的始末，发现更加精彩。在这里分享给大家。

> 长文预警！这篇文章相当长。但是也相当精彩。剧情反转超乎想象。有兴趣的请耐心观看。

# 知乎提问

先说问题的来源。问题的来源是一条知乎的提问，[为什么有些大公司技术弱爆了？](http://www.zhihu.com/question/32039226)。 为了方便大家阅读，我转载到这里。

## 提问原文

今年年初，到一家互联网公司实习，该公司是国内行业龙头。

不过技术和管理方面，却弱爆了。

那里的程序员，每天都在看邮件，查问题工单。
这些问题，多半是他们设计不当，造成的。

代码写的一团糟，全是复制粘贴，连作者都没改，大家普遍不写注释，也不格式化，代码歪歪扭扭。

一个项目里，httpclient竟然出现了四种。
一种是该公司研发部写的，
一种是老版本的开源项目，
一种是新版本的开源项目，
还有一种是开发人员造的轮子。

打接口请求响应日志，竟然不知道用拦截器。
打错误日志竟然不打上下文信息，每个人一种日志风格，千奇百怪。
许多重要的中间流程，居然不打日志。

idea、eclipse、myeclipse的配置文件竟然全部传到项目里去了。

该公司混了两年的程序员，跟快递公司做查询接口，竟然不知道加密运单号。

所有服务间通讯，都没有设requestId，导致跟踪会话很困难。

一个没什么qps的边缘接口，居然做消费者生产者+阻塞队列的异步模式。
显得你技术少是不是。
不知道异步会增加维护成本，提高测试难度吗？
而且，任务队里没有考虑持久化，赶上发布，丢了好多任务。

读取一个小小的xml和exc配置文件，居然用流式解析，没见过这么二逼的，真是醉了。

做优化全靠拍脑门拍大腿，难道不会用excel分析日志，用jprofile扫项目？
一个100以内的常数集合遍历，他也要写个优化算法进去，算法跟业务还搅在一起，一团乱麻。
每个人都在嚷嚷性能、算法、分布式计算……

几乎没有文档，全靠从代码反推逻辑。

有枚举他不用，非要在每个页面上，把枚举值挨个儿写死，知道后面改代码多么费劲吗？

欺骗性的变量名，里面存储的是AES加密的，变量名后缀却写成了DES；里面存的是小写字母，却写成upperStr。
一个方法十几个参数，有三分之一是极其简略的缩写，注释肯定也没有的。
一个类写到三四千行是常事。

开发自测，居然要把代码全丢到公共机器上，而且都是走svn，他们把svn当ftp用。
svn里面大量的无意义提交，一多半的提交连都编译不过去。
我看到有个应届生，改了两句话，马上提交，说是怕代码丢失。

一个运行了两年的项目，spring的包扫描明显配错了，有些bean根本扫不进来，居然没有人发现。
一半的bean在spring管理下，另一半的bean他们自己写单例模式来实例化。

他们用mysql来做审计系统，出报表，有个报表要跑8分钟。
原来是有人用字符串来存多值（逗号分隔），sql里写了like，导致没有利用到索引。
为什么不用pg，pg在sql编程方面，功能更丰富，更适合做统计，它本身就支持数组。

程序员们都是得过且过的态度，怎么把代码灌进去，跑的通测试，就算交差了。

为什么大型互联网公司，技术和管理这么差劲，是怎么形成的？
（这家公司是卖机票的，没有明确说出公司名字，是怕给自己惹麻烦）

# 萧井陌的回答

对这个问题，最精彩的是萧井陌的回答。目前已经有5000+的赞。这也是本文推荐的主要内容。

> 这个回答很长。一定要耐心读。一定会受益匪浅。

# 回答原文

作者：萧井陌

链接：http://www.zhihu.com/question/32039226/answer/76059969

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

楼主你好，我试着给你解释一下，希望你能满意。

新手经常会有这样的想法——「这代码怎么这么烂？写的人干什么吃的？怎么能这样？为什么不按照书上说的做？」，这很正常，大家都年轻过，经历过这种阶段，我懂你心里的想法，所以也愿意详细地向你解释，这一切发生的原因是什么。

你说「

不过技术和管理方面，却弱爆了。

那里的程序员，每天都在看邮件，查问题工单。

这些问题，多半是他们设计不当，造成的。

」

你真的觉得『国内行业老大的互联网公司』会是技术和管理弱爆了的样子吗？

你以为团队应该像永动机，但现实永远有各种摩擦、辐射、损耗。

内燃机的能量转化率，通常只有 30% - 50%，但是它却是驱动全世界运转的核心引擎，顺丰京东的快递小车、联通全国的高铁动车绿皮、瞬时直达的飞机……

机器尚不能 100% 效率运转，何况是人呢？

你说我们的程序员每天都在查看邮件、问题工单，你说这些问题多半是我们设计不当造成的，请问你有试过统计数据吗？你大概只是『感觉』如此吧？

事实上，经过十几年的发展，我们内部的『效率改进团队』已经非常高效成熟，每月、每周、甚至每天都会有新的改进，现在的业务处理方式，不说全世界，我可以自豪地说在全国我们是领先的，甚至是遥遥领先，不然凭啥坐到了全国龙头老大的位置呢？

所以啊，你只看到了程序员花在业务上的时间，没看到我们内部的『效率改进团队』为程序员们省掉的时间，我觉得我有必要站出来为默默付出的『效率改进团队』说几句。

当然，楼主作为实习生，不知道这些事情进而产生了这些疑问，也暴露了我们的不足。我已经在『团队建设委员会』里提出了这个问题，大家一致通过了决议，以后我们会对新员工——包括实习生加强企业文化、历史培训，确保我们的新伙伴们不仅知道要去哪儿，也要清楚我们从哪里来，长路漫漫，我们一同前行。

你觉得「

代码写的一团糟，全是复制粘贴，连作者都没改，大家普遍不写注释，也不格式化，代码歪歪扭扭。

」

当初公司起步的时候，整个项目都是几个初创程序员加班加点熬出来的，我知道你看过《代码大全》、《程序员修炼之道》、《Unix 编程艺术》，你对上面的准则信手拈来，你可否翻开床头柜上的这几本书，看看它们的出版时间呢？

是的，公司起步的时候，这几本书根本还没有出版，彼时中国互联网方兴未艾，大家都是摸着石头过河。现在你遇到问题，你可以问朋友、问导师、用谷歌、用栈溢出、用知乎，我们写程序那个年代，看的是谭浩强、严蔚敏，用的是 52k 拨号上网，语言只有 C，编辑器是没有语法高亮和实时编译的，编译器是没有智能准确的报错的，没有现在这么多知识、也没有这么多规范和好资源、好工具。不过我们还是把项目做出来了，把公司一步步推到了现在的位置。

不过这个问题是客观存在的问题，谁也不否认，但是你知道为什么你被分配到了一个『代码看上去一团糟也不够规范』的项目吗？我们需要新鲜血液来重构一些老代码，所以你会被分配到艰苦的岗位上。我们希望你是勇于战斗的战士，我们更希望你能成长为经验丰富的老兵，而把你放到这种岗位，是对你来说成长最快的方式。

你认为「

一个项目里，httpclient竟然出现了四种。

一种是该公司研发部写的，

一种是老版本的开源项目，

一种是新版本的开源项目，

还有一种是开发人员造的轮子。

」

你不知道的是，我们最初用了开源软件（也就是你所说的『老版本』），它构成了我们早期项目的基石，随着业务复杂性增加，我们改进并最终切换到新版本。

这个软件跑老业务非常成熟，但是在一些新业务上有不可调和的矛盾，所以在痛苦的适配后，研发部的同事们自告奋勇用 20% 的时间写了新业务的组件——是的你没看错我们也有 20% 时间，我们鼓励工程师的创新。

至于你说的开发人员造的轮子——这说起来可真有趣，它其实是前年来的一个清华大学实习生写的。

当时他来了之后，针对他接手业务的需求，向我抱怨说现有的 3 种都不好，要写一个新的来『统一天下』，这话是他的原话，我记得非常清楚，因为以我多年经验来看这样的做法是不可取的，但是本着锻炼年轻人的心态（加上他的确是不可多得的天才），我同意了他的请求，于是我用自己的业余时间接管了他的大部分工作，全力支持他写一个新的组件，帮他挡住了所有上面的压力，后来的故事就是你看到的这样。

是的，他后来越深入、就越来越感到业务的复杂，不断推翻重构、拆东墙补西墙，但始终发现和自己想的根本完全不一样，受不了了就走了，留下来这个。

我们明年的规划中，就包括剔除这个组件的 codebase，因为它实在是太糟糕了。

你又说「

打接口请求响应日志，竟然不知道用拦截器。

打错误日志竟然不打上下文信息，每个人一种日志风格，千奇百怪。

许多重要的中间流程，居然不打日志。

idea、eclipse、myeclipse的配置文件竟然全部传到项目里去了。

该公司混了两年的程序员，跟快递公司做查询接口，竟然不知道加密运单号。

所有服务间通讯，都没有设requestId，导致跟踪会话很困难。

」

拦截器并不如你所想的那班美好，也许你在自己的电脑上写过一些玩具代码，觉得这样很方便、酷炫，但是真正到了战场，你会发现没什么才是必须的、好的，只有适合的才是对的。

至于配置文件，这么说吧，IDE 的配置文件传到代码仓库是我定下的规矩，『怎么会有人定这样的规矩？』，是的你可能从软件工程的教科书上或者某些『知名博客』上读到了不能这样做，但实际上这样做在很多情况下是必须的。

原因何在？

这样可以确保代码克隆即可用，而不是让每个人都去设置一大堆无聊的东西，这样不仅节省时间，也确保了每个人的环境一致性，你想想这几年火热的 docker，应该明白了这样做的正确性和必要性了吧？

你可能会说即便如此、插件也不用上传到服务器保存，我告诉你这样是不行的，你要考虑到我们这个项目前后十余年，你觉得几个插件能坚挺十余年？很可能我们早期用的软件，现在你已经完全不可能找到了，所以保存一份备份是非常有必要的，决不能错误地认为是冗余。

教科书只会教你基本通用的原则，树立你基本正确的观念，但是如果只是死守教条，如何能拥抱日益复杂的变化呢？

你看的教科书，且不说时间上已经是二十多年前的了，在适用性上，也不说就是真理，IT 行业发展日新月异，几个月就是沧海桑田，为了适应这样的变化，认真地思考、总结、判断才是最重要的。

你觉得「

一个没什么qps的边缘接口，居然做消费者生产者+阻塞队列的异步模式。

显得你技术少是不是。

不知道异步会增加维护成本，提高测试难度吗？

而且，任务队里没有考虑持久化，赶上发布，丢了好多任务。

读取一个小小的xml和exc配置文件，居然用流式解析，没见过这么二逼的，真是醉了。

」

你大概不知道，当初跑在你口中的「一个没什么qps的边缘接口」上面的业务带来了公司曾经 90% 的收入，所以我们用了复杂的设计以应对当时的需求，当然现在业务转变，老系统不再需要处理那么多业务了，但是更没有理由为一个『works perfectly well』并且不再重要的业务重构代码吧？

所以，不是我们秀技术，而是业务需求 + 业务变更使然，年轻人还需要多学习一个。

你抱怨「

做优化全靠拍脑门拍大腿，难道不会用excel分析日志，用jprofile扫项目？

一个100以内的常数集合遍历，他也要写个优化算法进去，算法跟业务还搅在一起，一团乱麻。

每个人都在嚷嚷性能、算法、分布式计算……

几乎没有文档，全靠从代码反推逻辑。

有枚举他不用，非要在每个页面上，把枚举值挨个儿写死，知道后面改代码多么费劲吗？

欺骗性的变量名，里面存储的是AES加密的，变量名后缀却写成了DES；里面存的是小写字母，却写成upperStr。

一个方法十几个参数，有三分之一是极其简略的缩写，注释肯定也没有的。

一个类写到三四千行是常事。

」

我再强调一次——我们是全中国同类公司中技术能力第一的，你所说的问题，当然是不存在的。

我们有专门的 Hadoop 集群来分析日志，当然也就用不着 Excel 了。

对于我们这种体量的公司来说，不存在什么『常数集合』，代码必须用合适的数据结构——这是常识吧？

特殊的算法和业务掺杂以增加内聚性，这是我们多年的经验，的确，它和教科书上说的不一样，但是我前面说了，死守教条是不行的——想必你一定知道 OSI 7 层网络模型吧？

公司的技术氛围浓厚，是和公司的基因分不开的，我们公司最重要的原则就是——『拥抱变化』，从十几年前的机房托管单机到现在的庞大自建集群，技术跃迁了何止千万里，所以每个人都在学习新知识、每个人都沉浸在新知识的喜悦中。

你的问题，大多都是因为没有考虑到公司的庞大体量和十几年的技术跃迁才有的疑问，这点不再赘述，自行体会吧。

你想的是

「

开发自测，居然要把代码全丢到公共机器上，而且都是走svn，他们把svn当ftp用。

svn里面大量的无意义提交，一多半的提交连都编译不过去。

我看到有个应届生，改了两句话，马上提交，说是怕代码丢失。

一个运行了两年的项目，spring的包扫描明显配错了，有些bean根本扫不进来，居然没有人发现。

一半的bean在spring管理下，另一半的bean他们自己写单例模式来实例化。

」

其实那不是 SVN，那是我们公司自主研发的适应我们内部需求的 源代码管理系统 和 文件管理系统，你可以往里面放任何东西。

你所说的「无意义提交、一多半的提交连都编译不过去」其实只是表象，这套系统代号 TITAN，它自带 CIDD（持续继承、交付、部署），所以这些无法编译的提交都是不会有机会走到下一步流程的的。

如果你工作了一年，你就会发现这个需求是很重要的，改动、尤其是大型改动，中间会有很多非可用但有需要存档的步骤，现有的源代码管理系统都不能很好地支持这些需求，因此你也被教育了一套适应落后工具的思想。人啊，最重要的能力是改进工具，所以用 TITAN 的时候要拥抱全新思维，不要被落后思维捆绑。

如果你工作了几年，你可能还会问为什么我们没用 Jenkins、Travis 等工具，其实呀，就在 TITAN 之中呀，它凝结了公司最优秀的人才的十几年宝贵经验和心血。

By the way，我们最近正计划开源它，为中国开源社区做贡献，也希望提高业界的综合素质。欢迎你提交 PR 哦

你最后说「

他们用mysql来做审计系统，出报表，有个报表要跑8分钟。

原来是有人用字符串来存多值（逗号分隔），sql里写了like，导致没有利用到索引。

为什么不用pg，pg在sql编程方面，功能更丰富，更适合做统计，它本身就支持数组。

程序员们都是得过且过的态度，怎么把代码灌进去，跑的通测试，就算交差了。

为什么大型互联网公司，技术和管理这么差劲，是怎么形成的？

」

为什么不用 pg？如果你抱着这种想法，那用了 pg 也要被喷的，到时候就就会说 —— 「为什么不用 sqlite，轻量简单，搞这么复杂真的有必要吗？」，真的有必要。。。

这只是一个很简单的系统，做的事情也很简单，当初做这个系统的同事更熟悉 MySQL，当然 MySQL 是不二之选了，对于简单的东西，追求的是开发速度、使用便利性。

你觉得一个月跑一次的审计代码，8 分钟有什么问题吗？就算是一周跑一次，当然也是没问题的。

程序员的单位时间是如此宝贵，为了优化一段一个月跑一次的 8 分钟代码，值得花费数天的时间来做这件事吗？

重复一遍，你的问题，大多都是因为『没有考虑到公司的庞大体量和十几年的技术跃迁才有的疑问』，这点不再赘述，还请自行体会。

当然，年轻人乐于思考，这是好事，是希望，新鲜血液替换老旧部件系统才能健康发展成长，人如此、公司如此、国家也是如此。

希望你勤于思考，努力学习，有问题的话，我们公司是鼓励同事们向 CEO、CTO 写信的，不然也不会有 CEO、CTO 信箱了你说对吗？

当然，这样的技术性问题、你写给我就好，CEO 是船长，不需要关心底层锅炉房的细节。

另外我想补充一下我的想法，希望对你有所帮助。

你看你都没说加班问题，我们公司没加班啊，这多好，怎么做到激烈竞争下还能不加班的？都亏了公司老领导和元老们的一手决策

所以我想补充的不是技术问题，技术问题都不是问题，年轻人可以学习、交流，技术都会很快成长，毕竟年轻人的冲劲大、头脑灵活。

我想说的是整体观、大局观、大棋战略。

黄金的导电性最好，为什么电脑主板还要用铜？

清华大学最好，为什么有人要去普通学校？

飞机最快，为什么还有人坐火车？

因为资源都是有限的，我们在现实生活中——而不是教科书上——必须兼顾成本和产出的平衡。

你问我每行代码都多人多层人工 review 好不好？问我支不支持？我说好，review 我怎么能不支持呢？我今天在知乎这个公众平台我明确说了我支持。

但是你也应该多学习一个，这个现实毕竟是现实，我们要兼顾各种考量。

你今天在这里渲染「大公司技术和管理这么差劲」，是不对的、是失实的、是欠妥的、是缺乏认真思考的、是未加深入考量的。

将来舆论出了偏差，你虽然不用负责任，但是你认识到自己的错误的时候，会后悔、会内疚、会难过的吧？

何处乌托邦？或许……等下一代？

总结就是，生产效率才是最重要的，世间万物最重要的是平衡。

怎样取舍、如何妥协，这不仅是大自然的规律，也是我们前进、发展的准绳和仰仗的原则。

————

![](https://xuxinkun.github.io/img/zhihu/7.png)

@bhuztez 满意吗

## 知乎评论

这篇文章真的是精彩。特别是一些句式，模仿长者的口气，简直惟妙惟肖。这样精彩而认真的文章，也就引来了相当多的共鸣。可以看到很多评论已经深深陷入了对回答的认同。

![](https://xuxinkun.github.io/img/zhihu/1.png)

![](https://xuxinkun.github.io/img/zhihu/2.png)

![](https://xuxinkun.github.io/img/zhihu/3.png)

![](https://xuxinkun.github.io/img/zhihu/4.png)

看来这样的回答，还是有不少的共鸣的。至少我在第一遍读的时候，也有些认同。只是总感觉有些怪怪的。

# 回答始末

对于评论中那些**深以为然**的同学们，我真的只能说一句，**还是太年轻(too young too simple)**。因为萧大撰写此文的原委在这里

![](https://xuxinkun.github.io/img/zhihu/5.png)

这是一篇真正的洗地文。黑的水平之高，已经很难让人分清这是黑还是洗地。正如评论中所说

![](https://xuxinkun.github.io/img/zhihu/6.png)

明白了事情的原委，你再去读这篇帖子。是不是会有不一样的感受呢？

这剧情反转的太突然，不知道会不会让你惊掉下巴。

# 写在最后

[萧井陌](http://www.zhihu.com/people/xiao-jing-mo)是知乎上的大咖，很多回答有趣而精辟。大家可以去关注下。

